<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Distributing Python Packages &mdash; training.codefellows 1.0 documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="training.codefellows 1.0 documentation" href="../../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li><a href="../../index.html">training.codefellows 1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="distributing-python-packages">
<h1>Distributing Python Packages<a class="headerlink" href="#distributing-python-packages" title="Permalink to this headline">¶</a></h1>
<p>Over the past weeks, you&#8217;ve been creating python code and putting it into
repositories.</p>
<p>At the same time, you&#8217;ve been installing code created by other people using
<tt class="docutils literal"><span class="pre">pip</span></tt>.</p>
<p>Wouldn&#8217;t it be nice to be able to install your own code?</p>
<p>Or for that matter, to share code you&#8217;ve written with others so that they can
install it?</p>
<p>This brings us to the ideas of Packages and Distribution.</p>
<div class="section" id="python-packages">
<h2>Python Packages<a class="headerlink" href="#python-packages" title="Permalink to this headline">¶</a></h2>
<p>The code we&#8217;ve written so far has been pretty simple in structure.</p>
<p>We&#8217;ve limited ourselves to single Python files (<tt class="docutils literal"><span class="pre">modules</span></tt>) which provide
symbols.</p>
<p>We&#8217;ve seen how we can make <tt class="docutils literal"><span class="pre">modules</span></tt> <em>runnable</em> by adding <tt class="docutils literal"><span class="pre">__main__</span></tt>
blocks, and how we can use these to protect code we do not want to execute when
we import one of our modules.</p>
<p>We&#8217;ve also seen how we can import symbols from the modules we write into a
Python interpreter, or even into other Python modules we write.</p>
<p>But what happens when our code gets more complex?</p>
<p>What happens when we have a number of <tt class="docutils literal"><span class="pre">modules</span></tt> all of which are related?</p>
<p>We create packages.</p>
<p>A package is any folder that contains a file with the special name
<tt class="docutils literal"><span class="pre">__init__.py</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre>portlets/
├── __init__.py
├── ad.py
├── collection.py
├── events.py
├── support.py
├── thisweekshighlights.py
└── yellowpurple.py
</pre></div>
</div>
<p>The presence of a file called <tt class="docutils literal"><span class="pre">__init__.py</span></tt> in the directory called &#8220;portlets&#8221;
above turns the directory into a Python package.</p>
<p>Let&#8217;s create a &#8220;package&#8221; here in class.</p>
<p>Fire up a terminal and create a folder called <tt class="docutils literal"><span class="pre">mypackage</span></tt>.  In it, create
four files.  When you&#8217;re done, your directory structure should look like this:</p>
<div class="highlight-python"><div class="highlight"><pre>mypackage/
├── __init__.py
├── module1.py
├── module2.py
└── module3.py
</pre></div>
</div>
<p>In each of the three files starting with <tt class="docutils literal"><span class="pre">module</span></tt>, add the following function
(substitute the name of the Python file for <tt class="docutils literal"><span class="pre">&lt;modulename&gt;</span></tt>):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">whoami</span><span class="p">():</span>
    <span class="k">print</span> <span class="s">&quot;I am &lt;modulename&gt;&quot;</span>
</pre></div>
</div>
<p>Now, once you&#8217;ve saved all that, fire up a Python interpreter in the directory
that contains the <tt class="docutils literal"><span class="pre">mypackage</span></tt> directory.</p>
<p>Try the following:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">mypackage</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">dir</span><span class="p">()</span>
<span class="go">[&#39;__builtins__&#39;, &#39;__doc__&#39;, &#39;__name__&#39;, &#39;__package__&#39;, &#39;mypackage&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">mypackage.module1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">dir</span><span class="p">(</span><span class="n">mypackage</span><span class="p">)</span>
<span class="go">[&#39;__builtins__&#39;, &#39;__doc__&#39;, &#39;__file__&#39;, &#39;__name__&#39;, &#39;__package__&#39;, &#39;__path__&#39;, &#39;module1&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">dir</span><span class="p">(</span><span class="n">mypackage</span><span class="o">.</span><span class="n">module1</span><span class="p">)</span>
<span class="go">[&#39;__builtins__&#39;, &#39;__doc__&#39;, &#39;__file__&#39;, &#39;__name__&#39;, &#39;__package__&#39;, &#39;whoami&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mypackage</span><span class="o">.</span><span class="n">module1</span><span class="o">.</span><span class="n">whoami</span><span class="p">()</span>
<span class="go">I am module1</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
<div class="section" id="turn-data-structures-into-a-package">
<h3>Turn Data-Structures Into a Package<a class="headerlink" href="#turn-data-structures-into-a-package" title="Permalink to this headline">¶</a></h3>
<p>You&#8217;ve been building a collection of data-structure implementations in Python.</p>
<p>Let&#8217;s use that repository as a gateway to learning Python packaging and
distribution.</p>
<p>Our first step is to turn the collection of Python modules we have into a
<tt class="docutils literal"><span class="pre">package</span></tt>.</p>
<p>At the moment, your data-structures repository should look something like this:</p>
<div class="highlight-bash"><div class="highlight"><pre>heffalump:packaging cewing<span class="nv">$ </span><span class="nb">cd </span>data-structures
heffalump:data-structures cewing<span class="nv">$ </span>tree .
.
├── README.md
├── hash_tests.py
├── hasher.py
├── linked_list.py
├── linked_list_tests.py
├── ll_stack.py
├── make_month.py
├── make_month_tests.py
├── queue.py
├── queue_tests.py
├── requirements.txt
└── stack_tests.py
</pre></div>
</div>
<p>To turn this collection of modules into a Python <tt class="docutils literal"><span class="pre">package</span></tt>, all we have to do
is add an <tt class="docutils literal"><span class="pre">__init__.py</span></tt> file to the repository.</p>
<p>However, it&#8217;s worth thinking for a moment about the larger issue of
<tt class="docutils literal"><span class="pre">distributing</span></tt> our package before we do so.</p>
<p>When you want to share your code with others, there are two basic ways to do
so:</p>
<ol class="arabic simple">
<li>Point them to your repository and say &#8220;go to it&#8221;.</li>
<li>Provide them with a <tt class="docutils literal"><span class="pre">distribution</span></tt> of your code that they can install.</li>
</ol>
<p>Clearly, #2 is the more friendly of the two.</p>
<p>But when you do this, it&#8217;s not great to have all your program code <em>and</em> all
your tests all mashed together in one big blob.</p>
<p>So, let&#8217;s fix that for our package by separating the two.  We&#8217;ll create a pair
of <tt class="docutils literal"><span class="pre">packages</span></tt> in our repository, one to hold the program code, and one to
hold the tests.  Then we&#8217;ll move all the program code to the first, and all the
tests to the second:</p>
<div class="highlight-bash"><div class="highlight"><pre>heffalump:data-structures cewing<span class="nv">$ </span>mkdir data_structures
heffalump:data-structures cewing<span class="nv">$ </span>mkdir tests
heffalump:data-structures cewing<span class="nv">$ </span>git add data_structures tests
...
heffalump:data-structures cewing<span class="nv">$ </span>git commit -m <span class="s2">&quot;coverting to package&quot;</span>
...
heffalump:data-structures cewing<span class="nv">$ </span>git mv *tests*.py tests/
heffalump:data-structures cewing<span class="nv">$ </span>git mv *.py data_structures/
heffalump:data-structures cewing<span class="nv">$ </span>tree .
.
├── README.md
├── data_structures
│   ├── hasher.py
│   ├── linked_list.py
│   ├── ll_stack.py
│   ├── make_month.py
│   └── queue.py
├── requirements.txt
└── tests
    ├── hash_tests.py
    ├── linked_list_tests.py
    ├── make_month_tests.py
    ├── queue_tests.py
    └── stack_tests.py
</pre></div>
</div>
<p>Then, add an <tt class="docutils literal"><span class="pre">__init__.py</span></tt> file to each of our new sub-directories, turning
them into Python <tt class="docutils literal"><span class="pre">packages</span></tt>:</p>
<div class="highlight-bash"><div class="highlight"><pre>heffalump:data-structures cewing<span class="nv">$ </span>touch data_structures/__init__py tests/__init__.py
heffalump:data-structures cewing<span class="nv">$ </span>tree .
.
├── README.md
├── data_structures
│   ├── __init__py
│   ├── hasher.py
│   ├── linked_list.py
│   ├── ll_stack.py
│   ├── make_month.py
│   └── queue.py
├── requirements.txt
└── tests
    ├── __init__.py
    ├── hash_tests.py
    ├── linked_list_tests.py
    ├── make_month_tests.py
    ├── queue_tests.py
    └── stack_tests.py
</pre></div>
</div>
<p>So now we have two <tt class="docutils literal"><span class="pre">packages</span></tt>, but the issue that we have created is that the
code in our tests no longer has correct imports to get at the program code it
is designed to test.  Try it:</p>
<div class="highlight-bash"><div class="highlight"><pre>heffalump:data-structures cewing$ python tests/hash_tests.py
Traceback (most recent call last):
  File &quot;tests/hash_tests.py&quot;, line 2, in &lt;module&gt;
    import hasher
ImportError: No module named hasher
heffalump:data-structures cewing$
</pre></div>
</div>
<p>The answer to our problem is to turn this set of <tt class="docutils literal"><span class="pre">packages</span></tt> into a
<tt class="docutils literal"><span class="pre">distribution</span></tt>.</p>
</div>
</div>
<div class="section" id="python-distributions">
<h2>Python Distributions<a class="headerlink" href="#python-distributions" title="Permalink to this headline">¶</a></h2>
<p>Packaging and distribution in Python is a contentious issue. Debates rage over
<em>the right way</em>. More than one strong-hearted developer has been broken on the
rocks of trying to establish a standard that works.</p>
<p>Luckily, there is now <a class="reference external" href="http://python-packaging-user-guide.readthedocs.org">a standard</a> that points to the future.</p>
<p>You can just follow it to ensure that you are doing &#8220;the right thing™&#8221;.</p>
<div class="section" id="distutils-and-setuptools">
<h3>Distutils and Setuptools<a class="headerlink" href="#distutils-and-setuptools" title="Permalink to this headline">¶</a></h3>
<p>A <tt class="docutils literal"><span class="pre">distribution</span></tt> is defined by the <a class="reference external" href="http://python-packaging-user-guide.readthedocs.org/en/latest/glossary.html#term-distribution">packaging glossary</a> as:</p>
<div class="highlight-python"><div class="highlight"><pre>A Python distribution is a versioned archive file that contains Python
packages, modules, and other resource files that are used to distribute a
Release. The distribution file is what an end-user will download from the
internet and install.
</pre></div>
</div>
<p>Distribution of Python packages was first established via a standard library
module called <a class="reference external" href="http://docs.python.org/2/distutils/">distutils</a> However, as packaging needs grew more complex, the
limitations of that code led to the creation of a new library to extend it,
<a class="reference external" href="http://pythonhosted.org/setuptools/">setuptools</a>.</p>
<p>Both of these libraries work off of the idea of a file called <tt class="docutils literal"><span class="pre">setup.py</span></tt>,
which is responsible for establishing a set of <em>metadata</em> about a distribution
and the code it contains.</p>
<p>This file contains two main Python statements, an import statement that pulls
the <tt class="docutils literal"><span class="pre">setup</span></tt> function into the module namespace, and a call of that function,
which builds package metadata.</p>
<p>Let&#8217;s add such a file to our project code base:</p>
<div class="highlight-bash"><div class="highlight"><pre>heffalump:data-structures cewing<span class="nv">$ </span>touch setup.py
heffalump:data-structures cewing<span class="nv">$ </span>ls
README.md       requirements.txt    tests
data_structures     setup.py
</pre></div>
</div>
<p>Then open the file in your editor and add the following code:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">setuptools</span> <span class="kn">import</span> <span class="n">setup</span>

<span class="n">long_description</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">This is a package that provides some basic data structures implemented in</span>
<span class="s">Python.</span>
<span class="s">&quot;&quot;&quot;</span>

<span class="n">setup</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s">&quot;data-structures&quot;</span><span class="p">,</span>
    <span class="n">version</span><span class="o">=</span><span class="s">&quot;0.1-dev&quot;</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s">&quot;Basic Data Structures&quot;</span><span class="p">,</span>
    <span class="n">long_description</span><span class="o">=</span><span class="n">long_description</span><span class="p">,</span>
    <span class="c"># The project URL.</span>
    <span class="n">url</span><span class="o">=</span><span class="s">&#39;http://github.com/&lt;yourname&gt;/data-structures&#39;</span><span class="p">,</span>
    <span class="c"># Author details</span>
    <span class="n">author</span><span class="o">=</span><span class="s">&#39;&lt;Your Name&gt;&#39;</span><span class="p">,</span>
    <span class="n">author_email</span><span class="o">=</span><span class="s">&#39;&lt;your.email@domain.com&#39;</span><span class="p">,</span>
    <span class="c"># Choose your license</span>
    <span class="c">#   and remember to include the license text in a &#39;docs&#39; directory.</span>
    <span class="c"># license=&#39;MIT&#39;,</span>
    <span class="n">packages</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;data_structures&#39;</span><span class="p">],</span>
    <span class="n">install_requires</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;setuptools&#39;</span><span class="p">,</span> <span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
<p>This will turn our data-structures repository into an installable distribution.
The distribution will provide one Python package called <tt class="docutils literal"><span class="pre">data_structures</span></tt></p>
<p>Let&#8217;s install our package into a virtualenv and try it out.</p>
<div class="highlight-bash"><div class="highlight"><pre>heffalump:data-structures cewing<span class="nv">$ </span>mkvirtualenv dsenv
New python executable in dsenv/bin/python
Installing setuptools, pip...done.
<span class="o">[</span>dsenv<span class="o">]</span>
heffalump:data-structures cewing<span class="nv">$ </span>python setup.py install
running install
...
Using /Users/cewing/virtualenvs/dsenv/lib/python2.7/site-packages
Finished processing dependencies <span class="k">for </span>data-structures<span class="o">==</span>0.1-dev
<span class="o">[</span>dsenv<span class="o">]</span>
heffalump:data-structures cewing<span class="nv">$ </span>python
Python 2.7.5 <span class="o">(</span>default, Aug 25 2013, 00:04:04<span class="o">)</span>
<span class="o">[</span>GCC 4.2.1 Compatible Apple LLVM 5.0 <span class="o">(</span>clang-500.0.68<span class="o">)]</span> on darwin
Type <span class="s2">&quot;help&quot;</span>, <span class="s2">&quot;copyright&quot;</span>, <span class="s2">&quot;credits&quot;</span> or <span class="s2">&quot;license&quot;</span> <span class="k">for </span>more information.
&gt;&gt;&gt; import data_structures
&gt;&gt;&gt; from data_structures.hasher import HashTable
&gt;&gt;&gt;
</pre></div>
</div>
<p>However, we still can&#8217;t run our tess:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="o">[</span>dsenv<span class="o">]</span>
heffalump:data-structures cewing<span class="nv">$ </span>python tests/hash_tests.py
Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
  File <span class="s2">&quot;tests/hash_tests.py&quot;</span>, line 2, in &lt;module&gt;
    import hasher
ImportError: No module named hasher
<span class="o">[</span>dsenv<span class="o">]</span>
</pre></div>
</div>
<p>The reason for this has to do with the format of our import. We are trying to
import the <tt class="docutils literal"><span class="pre">hasher.py</span></tt> module as if it were at the top level of our package,
but it isn&#8217;t. It&#8217;s actually an attribute of the <tt class="docutils literal"><span class="pre">data_structures</span></tt> package.</p>
<p>Now we can fix that in our <tt class="docutils literal"><span class="pre">hash_tests.py</span></tt> file.  Edit that file so that we
import our symbols from the right place:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">from</span> <span class="nn">data_structures.hasher</span> <span class="kn">import</span> <span class="n">HashTable</span>

<span class="k">class</span> <span class="nc">TestInit</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_small_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ht</span> <span class="o">=</span> <span class="n">HashTable</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>
        <span class="o">...</span>
</pre></div>
</div>
<p>And now, our tests work:</p>
<div class="highlight-bash"><div class="highlight"><pre>heffalump:data-structures cewing$ python tests/hash_tests.py
.............
----------------------------------------------------------------------
Ran 13 tests in 0.010s

OK
[dsenv]
heffalump:data-structures cewing$
</pre></div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Distributing Python Packages</a><ul>
<li><a class="reference internal" href="#python-packages">Python Packages</a><ul>
<li><a class="reference internal" href="#turn-data-structures-into-a-package">Turn Data-Structures Into a Package</a></li>
</ul>
</li>
<li><a class="reference internal" href="#python-distributions">Python Distributions</a><ul>
<li><a class="reference internal" href="#distutils-and-setuptools">Distutils and Setuptools</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../_sources/lectures/day14/python_packages.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li><a href="../../index.html">training.codefellows 1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, Cris Ewing.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.1.
    </div>
  </body>
</html>