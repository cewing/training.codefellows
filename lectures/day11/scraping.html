<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Extracting Data from the Web &mdash; training.codefellows 1.0 documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="training.codefellows 1.0 documentation" href="../../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li><a href="../../index.html">training.codefellows 1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="extracting-data-from-the-web">
<h1>Extracting Data from the Web<a class="headerlink" href="#extracting-data-from-the-web" title="Permalink to this headline">¶</a></h1>
<div class="section" id="web-scraping">
<h2>Web Scraping<a class="headerlink" href="#web-scraping" title="Permalink to this headline">¶</a></h2>
<p>The internet makes a vast quantity of data available.</p>
<p>But not always in the form or combination you want.</p>
<p>It can be nice to combine data from different sources to create <em>meaning</em>.</p>
<div class="section" id="data-sources">
<h3>Data Sources<a class="headerlink" href="#data-sources" title="Permalink to this headline">¶</a></h3>
<p>Data online comes in many different formats:</p>
<ul class="simple">
<li>Simple websites with data in HTML</li>
<li>Web services providing structured data</li>
<li>Web services providing tranformative service (geocoding)</li>
<li>Web services providing presentation (mapping)</li>
</ul>
<p>Let&#8217;s concentrate on that first class of data, HTML.</p>
</div>
</div>
<div class="section" id="html-data">
<h2>HTML Data<a class="headerlink" href="#html-data" title="Permalink to this headline">¶</a></h2>
<p>Ideally HTML would be well-formed and strictly correct in it&#8217;s structure:</p>
<div class="highlight-html"><div class="highlight"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;p&gt;</span>A nice clean paragraph<span class="nt">&lt;/p&gt;</span>
    <span class="nt">&lt;p&gt;</span>And another nice clean paragraph<span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
<p>But in fact, it usually ends up looking more like this:</p>
<div class="highlight-html"><div class="highlight"><pre><span class="nt">&lt;html&gt;</span>
 <span class="nt">&lt;form&gt;</span>
  <span class="nt">&lt;table&gt;</span>
   <span class="nt">&lt;td&gt;&lt;input</span> <span class="na">name=</span><span class="s">&quot;input1&quot;</span><span class="nt">&gt;</span>Row 1 cell 1
   <span class="nt">&lt;tr&gt;&lt;td&gt;</span>Row 2 cell 1
  <span class="nt">&lt;/form&gt;</span>
  <span class="nt">&lt;td&gt;</span>Row 2 cell 2<span class="nt">&lt;br&gt;</span>This<span class="nt">&lt;/br&gt;</span> sure is a long cell
 <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
<p>An Internet Law: &#8220;Be strict in what you send and tolerant in what you receive&#8221;</p>
<a class="reference internal image-reference" href="../../_images/scream.jpg"><img alt="../../_images/scream.jpg" class="align-center" src="../../_images/scream.jpg" style="width: 60%;" /></a>
<p>Photo by Matthew via Flickr (<a class="reference external" href="http://www.flickr.com/photos/purplemattfish/3918004964/">http://www.flickr.com/photos/purplemattfish/3918004964/</a>) - CC-BY-NC-ND</p>
<div class="section" id="cleaning-up-the-mess">
<h3>Cleaning Up the Mess<a class="headerlink" href="#cleaning-up-the-mess" title="Permalink to this headline">¶</a></h3>
<p>My favorite library for dealing with the mess that HTML can become is
<a class="reference external" href="http://www.crummy.com/software/BeautifulSoup/bs4/doc/">BeautifulSoup</a>. So let&#8217;s go ahead and create a virtualenv for playing with it
a bit:</p>
<div class="highlight-bash"><div class="highlight"><pre>heffalump:~ cewing$ mkproject souptests
New python executable in souptests/bin/python
Installing setuptools, pip...done.
Creating /Users/cewing/projects/souptests
Setting project for souptests to /Users/cewing/projects/souptests
[souptests]
heffalump:souptests cewing$
</pre></div>
</div>
<p>Then, install the correct version of BeautifulSoup (you want 4, not 3):</p>
<div class="highlight-bash"><div class="highlight"><pre>[souptests]
heffalump:souptests cewing$ pip install beautifulsoup4
Downloading/unpacking beautifulsoup4
  Downloading beautifulsoup4-4.3.2.tar.gz (143kB): 143kB downloaded
  Running setup.py (path:/Users/cewing/virtualenvs/souptests/build/beautifulsoup4/setup.py) egg_info for package beautifulsoup4

Installing collected packages: beautifulsoup4
  Running setup.py install for beautifulsoup4

Successfully installed beautifulsoup4
Cleaning up...
[souptests]
heffalump:souptests cewing$
</pre></div>
</div>
<p>BeautifulSoup can use the Python HTMLParser.</p>
<p><em>PRO</em> Batteries Included.  It&#8217;s already there</p>
<p><em>CON</em> It&#8217;s not great, especially before Python 2.7.3</p>
<p>BeautifulSoup also supports using other parsers.</p>
<p>There are two good choices: <a class="reference external" href="http://lxml.de">lxml</a>  and <a class="reference external" href="http://html5lib.readthedocs.org.">html5lib</a>.</p>
<p><tt class="docutils literal"><span class="pre">lxml</span></tt> is better, but it can be much harder to install.  For our exercise,
Let&#8217;s use <tt class="docutils literal"><span class="pre">html5lib</span></tt>:</p>
<div class="highlight-bash"><div class="highlight"><pre>[souptests]
heffalump:souptests cewing$ pip install html5lib
Downloading/unpacking html5lib
  Downloading html5lib-0.999.tar.gz (885kB): 885kB downloaded
  Running setup.py (path:/Users/cewing/virtualenvs/souptests/build/html5lib/setup.py) egg_info for package html5lib

Downloading/unpacking six (from html5lib)
  Downloading six-1.5.2-py2.py3-none-any.whl
Installing collected packages: html5lib, six
  Running setup.py install for html5lib

Successfully installed html5lib six
Cleaning up...
[souptests]
heffalump:souptests cewing$
</pre></div>
</div>
<p>Once installed, BeautifulSoup will choose it automatically. Actually,
BeautifulSoup will choose the &#8220;best&#8221; available.</p>
<p>You can specify the parser if you need to control it and you have more than one
available.</p>
</div>
<div class="section" id="getting-webpages">
<h3>Getting Webpages<a class="headerlink" href="#getting-webpages" title="Permalink to this headline">¶</a></h3>
<p>Python provides tools for opening urls and communicating with servers. It&#8217;s
spread across the <tt class="docutils literal"><span class="pre">urllib</span></tt> and <tt class="docutils literal"><span class="pre">urllib2</span></tt> packages.</p>
<p>These packages have pretty unintuitive APIs.</p>
<p>The <tt class="docutils literal"><span class="pre">requests</span></tt> library is becoming the de-facto standard for this type of
work.  Let&#8217;s install it too.</p>
<div class="highlight-bash"><div class="highlight"><pre>[souptests]
heffalump:souptests cewing$ pip install requests
Downloading/unpacking requests
  Downloading requests-2.2.1-py2.py3-none-any.whl (625kB): 625kB downloaded
Installing collected packages: requests
Successfully installed requests
Cleaning up...
[souptests]
heffalump:souptests cewing$
</pre></div>
</div>
<p>In <tt class="docutils literal"><span class="pre">requests</span></tt>, each HTTP method is provided by a module-level function:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">GET</span></tt> == <tt class="docutils literal"><span class="pre">requests.get(url,</span> <span class="pre">**kwargs)</span></tt></li>
<li><tt class="docutils literal"><span class="pre">POST</span></tt> == <tt class="docutils literal"><span class="pre">requests.post(url,</span> <span class="pre">**kwargs)</span></tt></li>
<li>...</li>
</ul>
<p>Those unspecified <tt class="docutils literal"><span class="pre">kwargs</span></tt> represent other parts of an HTTP request:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">params</span></tt>: a dict of url query parameters (?foo=bar&amp;baz=bim)</li>
<li><tt class="docutils literal"><span class="pre">headers</span></tt>: a dict of headers to send with the request</li>
<li><tt class="docutils literal"><span class="pre">data</span></tt>: the body of the request, if any (form data for POST goes here)</li>
<li>...</li>
</ul>
<p>The return value from one of these functions is a <tt class="docutils literal"><span class="pre">response</span></tt> which provides:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">response.status_code</span></tt>: see the HTTP Status Code returned</li>
<li><tt class="docutils literal"><span class="pre">response.ok</span></tt>: True if <tt class="docutils literal"><span class="pre">response.status_code</span></tt> is not an error</li>
<li><tt class="docutils literal"><span class="pre">response.raise_for_status()</span></tt>: call to raise a python error if it is</li>
<li><tt class="docutils literal"><span class="pre">response.headers</span></tt>: The headers sent from the server</li>
<li><tt class="docutils literal"><span class="pre">response.text</span></tt>: Body of the response, decoded to unicode</li>
<li><tt class="docutils literal"><span class="pre">response.encoding</span></tt>: The encoding used to decode</li>
<li><tt class="docutils literal"><span class="pre">response.content</span></tt>: The original encoded response body as bytes</li>
</ul>
<p>You can <a class="reference external" href="http://requests.readthedocs.org">read more about this library</a> on your own. I urge you to do so.</p>
</div>
</div>
<div class="section" id="an-example-scraping-blog-posts">
<h2>An Example: Scraping Blog Posts<a class="headerlink" href="#an-example-scraping-blog-posts" title="Permalink to this headline">¶</a></h2>
<p>Let&#8217;s use the tools we&#8217;ve set up here to play with scraping a simple structure,
a list of blog posts.</p>
<p>Begin by firing up a Python interpreter:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="o">[</span>souptests<span class="o">]</span>
heffalump:souptests cewing<span class="nv">$ </span>python
Python 2.7.5 <span class="o">(</span>default, Aug 25 2013, 00:04:04<span class="o">)</span>
<span class="o">[</span>GCC 4.2.1 Compatible Apple LLVM 5.0 <span class="o">(</span>clang-500.0.68<span class="o">)]</span> on darwin
Type <span class="s2">&quot;help&quot;</span>, <span class="s2">&quot;copyright&quot;</span>, <span class="s2">&quot;credits&quot;</span> or <span class="s2">&quot;license&quot;</span> <span class="k">for </span>more information.
&gt;&gt;&gt;
</pre></div>
</div>
<p>Then, import the requests library and fetch our sample blog listing page:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">requests</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">url</span> <span class="o">=</span> <span class="s">&#39;http://tinyurl.com/sample-oss-posts&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">resp</span>
<span class="go">&lt;Response [200]&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">foo</span> <span class="o">=</span> <span class="n">resp</span><span class="o">.</span><span class="n">text</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span>
<span class="go">601747</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">resp</span><span class="o">.</span><span class="n">encoding</span>
<span class="go">&#39;utf-8&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span>
<span class="go">&lt;type &#39;unicode&#39;&gt;</span>
</pre></div>
</div>
<p>Let&#8217;s prevent ourselves from having to repeat that step by writing our fetched
webpage out to the filesystem:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">bytes</span> <span class="o">=</span> <span class="n">resp</span><span class="o">.</span><span class="n">content</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="nb">bytes</span><span class="p">)</span>
<span class="go">602455</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;blog_list.html&#39;</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">bytes</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">os</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>
<span class="go">[&#39;blog_list.html&#39;, &#39;scraper.py&#39;]</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>You should now be able to open the new file in your web browser.  Do so.</p>
<p>The first step is to identify the smallest container element comment to all the
things you want to extract.  We want to get all blog posts, so let&#8217;s find the
container that wraps each one.</p>
<p><strong>What&#8217;s the best tool for getting this information from a web page?</strong></p>
<div class="section" id="parsing-html">
<h3>Parsing HTML<a class="headerlink" href="#parsing-html" title="Permalink to this headline">¶</a></h3>
<p>When you look at the HTML from this webpage in your browser&#8217;s devtools, it
displays as a formatted structure of HTML tags.  We can interact with those
tags in devtools because they are actually just representations of a DOM node.
(DOM stands for <a class="reference external" href="http://en.wikipedia.org/wiki/Document_Object_Model">Document Object Model</a>)</p>
<p>In order to work with the page in the same fashion in Python, we need to
<strong>parse</strong> it into the same kind of structure.  That&#8217;s what <tt class="docutils literal"><span class="pre">BeautifulSoup</span></tt>
does for us.</p>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parsed</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">parsed</span><span class="p">)</span>
<span class="go">2</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>So parsing the document took the length from 601747 characters to 2 <em>??</em>. What
are those two things?</p>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="nb">type</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">parsed</span><span class="p">]</span>
<span class="go">[&lt;class &#39;bs4.element.Doctype&#39;&gt;, &lt;class &#39;bs4.element.Tag&#39;&gt;]</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>Once an html page has been parsed by <tt class="docutils literal"><span class="pre">BeautifulSoup</span></tt>, everything becomes a
<tt class="docutils literal"><span class="pre">node</span></tt>.  The parsed document itself is a <tt class="docutils literal"><span class="pre">node</span></tt> and <tt class="docutils literal"><span class="pre">nodes</span></tt> are iterable.</p>
<p>When you iterate over a node, you get the nodes that it contains in the DOM
tree.</p>
<p>These nodes can be roughly classed into two types, <tt class="docutils literal"><span class="pre">NavigableString</span></tt> and
<tt class="docutils literal"><span class="pre">Tag</span></tt></p>
<p>The main difference is that <tt class="docutils literal"><span class="pre">Tag</span></tt> nodes can contain other nodes, where
<tt class="docutils literal"><span class="pre">NavigableStrings</span></tt> do not.</p>
<p>You can interact with these node types in a number of ways.  Let&#8217;s start with a
way of working with <tt class="docutils literal"><span class="pre">Tags</span></tt>, <em>searching</em>.</p>
</div>
<div class="section" id="searching-html">
<h3>Searching HTML<a class="headerlink" href="#searching-html" title="Permalink to this headline">¶</a></h3>
<p>A <tt class="docutils literal"><span class="pre">Tag</span></tt> in <tt class="docutils literal"><span class="pre">BeautifulSoup</span></tt> has a couple of methods that support searching:
<tt class="docutils literal"><span class="pre">find</span></tt> and <tt class="docutils literal"><span class="pre">find_all</span></tt>. The former will find the first instance of a node
that matches the search specification.  The second will find <strong>all</strong> instances.</p>
<p>How do we build a specification for searching? The call signature for
<tt class="docutils literal"><span class="pre">find_all</span></tt> helps a bit:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">tag</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">recursive</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">name</span></tt> is the name of an html tag type (&#8216;a&#8217;, &#8216;p&#8217;, &#8216;div&#8217;, etc.)</li>
<li><tt class="docutils literal"><span class="pre">attrs</span></tt> is a dictionary of key-value pairs where the key is an html
attribute name and the value is the value you want to match.</li>
<li><tt class="docutils literal"><span class="pre">recursive</span></tt> controls whether to find <em>descendents</em> (the default) or just
<em>children</em> (recursive=False)</li>
<li><tt class="docutils literal"><span class="pre">text</span></tt> allows you to find <tt class="docutils literal"><span class="pre">NavigableString</span></tt> nodes instead of <tt class="docutils literal"><span class="pre">Tag</span></tt> nodes.</li>
<li><tt class="docutils literal"><span class="pre">limit</span></tt> controls how many to find, maximum.</li>
</ul>
<p>The last element <strong>kwargs</strong> allows you to pass arbitrary keyword arguments.  If
the argument you pass is not recognized as one of the other arguments, it will
be treated as the name of an <em>attribute</em> to filter on, so passing
<tt class="docutils literal"><span class="pre">id=&quot;my-div&quot;</span></tt> would result in a search for any item with the id &#8220;my-div&#8221;</p>
<p><strong>NOTE</strong> because <tt class="docutils literal"><span class="pre">class</span></tt> is a keyword in python, you can&#8217;t use it as a
keyword argument.  Instead you should use <tt class="docutils literal"><span class="pre">class_</span></tt> (<tt class="docutils literal"><span class="pre">class_=&quot;button&quot;</span></tt>)</p>
<p>Looking at the blog listing, we can see that the container that is wrapped
around each post shares a common <em>CSS class</em>: <tt class="docutils literal"><span class="pre">feedEntry</span></tt>. Let&#8217;s grab all of
them:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">entries</span> <span class="o">=</span> <span class="n">parsed</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s">&#39;div&#39;</span><span class="p">,</span> <span class="n">class_</span><span class="o">=</span><span class="s">&#39;feedEntry&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span>
<span class="go">105</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>Okay. That works.</p>
<p>Let&#8217;s see if we can extract a list of the titles of each post.</p>
<p>For this, we want to make sure we find the <strong>first</strong> anchor tag in each entry,
and then extract the text it contains:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">e1</span> <span class="o">=</span> <span class="n">entries</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">e1</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
<span class="go">u&#39;\n            Dimitri Fontaine: PostgreSQL, Aggregates and Histograms\n        &#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">e1</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;h2&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">string</span>
<span class="go">u&#39;Dimitri Fontaine: PostgreSQL, Aggregates and Histograms&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">titles</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;h2&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">string</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">titles</span><span class="p">)</span>
<span class="go">105</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>We can also find the set of possible sources for our blog posts.  The byline is
contained in a <tt class="docutils literal"><span class="pre">&lt;p&gt;</span></tt> tag with the CSS class <tt class="docutils literal"><span class="pre">discreet</span></tt>.  Let&#8217;s gather up
all of those and see what we have:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">byline</span> <span class="o">=</span> <span class="n">e1</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;p&#39;</span><span class="p">,</span> <span class="n">class_</span><span class="o">=</span><span class="s">&#39;discreet&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">byline</span><span class="o">.</span><span class="n">children</span><span class="p">))</span>
<span class="go">3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="nb">type</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">byline</span><span class="o">.</span><span class="n">children</span><span class="p">)]</span>
<span class="go">[&lt;class &#39;bs4.element.NavigableString&#39;&gt;, &lt;class &#39;bs4.element.Tag&#39;&gt;, &lt;class &#39;bs4.element.NavigableString&#39;&gt;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">classifier</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">byline</span><span class="o">.</span><span class="n">children</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">classifier</span>
<span class="go">u&#39;From Planet PostgreSQL.\n            \n            \n                Published on&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">all_bylines</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;p&#39;</span><span class="p">,</span> <span class="n">class_</span><span class="o">=</span><span class="s">&#39;discreet&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">all_bylines</span><span class="p">)</span>
<span class="go">105</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">all_classifiers</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">children</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">all_bylines</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">all_classifiers</span><span class="p">)</span>
<span class="go">105</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">all_classifiers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">u&#39;From Planet PostgreSQL.\n            \n            \n                Published on&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">unique_classifiers</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">all_classifiers</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">unique_classifiers</span><span class="p">)</span>
<span class="go">30</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pprint</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pprint</span><span class="o">.</span><span class="n">ppirnt</span><span class="p">(</span><span class="n">unique_classifiers</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">&lt;module&gt;</span>
<span class="gr">AttributeError</span>: <span class="n">&#39;module&#39; object has no attribute &#39;ppirnt&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">unique_classifiers</span><span class="p">)</span>
<span class="go">set([u&#39;By Adrian Holovaty from Planet Django.\n ...</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>If we look these over, we find that we have some from <tt class="docutils literal"><span class="pre">Planet</span> <span class="pre">Django</span></tt>, some
from <tt class="docutils literal"><span class="pre">Planet</span> <span class="pre">PostgreSQL</span></tt> and maybe some others as well (I get one from
<tt class="docutils literal"><span class="pre">plope</span></tt> too).</p>
<p>Let&#8217;s take one more step, and divide our post titles into categories based on
whether they are Django, PostgreSQL or other:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">get_classifier</span><span class="p">(</span><span class="n">entry</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">byline</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;p&#39;</span><span class="p">,</span> <span class="n">class_</span><span class="o">=</span><span class="s">&#39;discreet&#39;</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">for</span> <span class="n">classifier</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;django&#39;</span><span class="p">,</span> <span class="s">&#39;postgresql&#39;</span><span class="p">]:</span>
<span class="gp">... </span>        <span class="k">if</span> <span class="n">classifier</span> <span class="ow">in</span> <span class="n">byline</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
<span class="gp">... </span>            <span class="k">return</span> <span class="n">classifier</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="s">&#39;other&#39;</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">classifiers</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_classifier</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">classifiers</span><span class="p">))</span>
<span class="go">3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">set</span><span class="p">(</span><span class="n">classifiers</span><span class="p">)</span>
<span class="go">set([&#39;other&#39;, &#39;postgresql&#39;, &#39;django&#39;])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">get_title</span><span class="p">(</span><span class="n">entry</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">entry</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;h2&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">string</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">titles</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_title</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">titles</span><span class="p">)</span>
<span class="go">105</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">titles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">u&#39;Dimitri Fontaine: PostgreSQL, Aggregates and Histograms&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">paired</span> <span class="o">=</span> <span class="p">[(</span><span class="n">get_classifier</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="n">get_title</span><span class="p">(</span><span class="n">e</span><span class="p">))</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">paired</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">(&#39;postgresql&#39;, u&#39;Dimitri Fontaine: PostgreSQL, Aggregates and Histograms&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">groups</span> <span class="o">=</span> <span class="p">{}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">cat</span><span class="p">,</span> <span class="n">title</span> <span class="ow">in</span> <span class="n">paired</span><span class="p">:</span>
<span class="gp">... </span>    <span class="nb">list</span> <span class="o">=</span> <span class="n">groups</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">cat</span><span class="p">,</span> <span class="p">[])</span>
<span class="gp">... </span>    <span class="nb">list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">groups</span><span class="p">[</span><span class="s">&#39;other&#39;</span><span class="p">]</span>
<span class="go">[u&#39;Is Open Source Consulting Dead?&#39;, u&#39;Consulting and Patent Indemification&#39;,</span>
<span class="go"> u&#39;Python Advent Calendar 2012 Topic&#39;, u&#39;Why I Like ZODB&#39;, ...]</span>
</pre></div>
</div>
<p>Neat!</p>
</div>
</div>
<div class="section" id="going-farther">
<h2>Going Farther<a class="headerlink" href="#going-farther" title="Permalink to this headline">¶</a></h2>
<p>Okay, so that&#8217;s the basics. For your assignment, take this and build a list of
apartment listings using Craigslist.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Extracting Data from the Web</a><ul>
<li><a class="reference internal" href="#web-scraping">Web Scraping</a><ul>
<li><a class="reference internal" href="#data-sources">Data Sources</a></li>
</ul>
</li>
<li><a class="reference internal" href="#html-data">HTML Data</a><ul>
<li><a class="reference internal" href="#cleaning-up-the-mess">Cleaning Up the Mess</a></li>
<li><a class="reference internal" href="#getting-webpages">Getting Webpages</a></li>
</ul>
</li>
<li><a class="reference internal" href="#an-example-scraping-blog-posts">An Example: Scraping Blog Posts</a><ul>
<li><a class="reference internal" href="#parsing-html">Parsing HTML</a></li>
<li><a class="reference internal" href="#searching-html">Searching HTML</a></li>
</ul>
</li>
<li><a class="reference internal" href="#going-farther">Going Farther</a></li>
</ul>
</li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../_sources/lectures/day11/scraping.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li><a href="../../index.html">training.codefellows 1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, Cris Ewing.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.1.
    </div>
  </body>
</html>